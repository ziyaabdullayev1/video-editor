<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video URL Debug Tool</title>
    <style>
        body {
            font-family: monospace;
            background: #0b0d12;
            color: #e9eef5;
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
        }
        .section {
            background: #1a1d24;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #60a5fa;
        }
        h2 { color: #60a5fa; margin-top: 0; }
        input {
            width: 100%;
            padding: 10px;
            background: #0b0d12;
            border: 1px solid #374151;
            color: #e9eef5;
            border-radius: 4px;
            margin: 10px 0;
            box-sizing: border-box;
        }
        button {
            background: #3b82f6;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #2563eb; }
        .result {
            background: #0b0d12;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            border: 1px solid #374151;
        }
        .success { border-color: #10b981; color: #10b981; }
        .error { border-color: #ef4444; color: #ef4444; }
        .warning { border-color: #f59e0b; color: #f59e0b; }
        video {
            width: 100%;
            max-width: 640px;
            background: #000;
            border-radius: 4px;
        }
        pre {
            overflow-x: auto;
            background: #0f1419;
            padding: 10px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>üîç Video URL Debug Tool</h1>

    <div class="section">
        <h2>1. URL'yi Test Et</h2>
        <input 
            type="text" 
            id="videoUrl" 
            value="https://videocut.boencv.com/outputs/output_1759526107745.mp4_final_output.mp4"
            placeholder="Video URL'sini girin"
        >
        <button onclick="testUrl()">üß™ URL'yi Test Et</button>
        <button onclick="openInNewTab()">üîó Yeni Sekmede A√ß</button>
        <div id="urlResult"></div>
    </div>

    <div class="section">
        <h2>2. Video Y√ºkleme Testi</h2>
        <button onclick="testVideoLoad()">‚ñ∂Ô∏è Video Y√ºkle ve Oynat</button>
        <div id="videoResult"></div>
        <video id="testVideo" controls style="margin-top: 10px; display: none;"></video>
    </div>

    <div class="section">
        <h2>3. CORS Testi</h2>
        <button onclick="testCors()">üîê CORS Kontrol√º</button>
        <div id="corsResult"></div>
    </div>

    <div class="section">
        <h2>4. Olasƒ± √á√∂z√ºmler</h2>
        <div id="solutions"></div>
    </div>

    <script>
        async function testUrl() {
            const url = document.getElementById('videoUrl').value;
            const resultDiv = document.getElementById('urlResult');
            resultDiv.innerHTML = '<div class="result warning">‚è≥ Test ediliyor...</div>';

            try {
                const response = await fetch(url, { method: 'HEAD' });
                const status = response.status;
                const contentType = response.headers.get('content-type');
                const contentLength = response.headers.get('content-length');

                let html = `<div class="result ${status === 200 ? 'success' : 'error'}">
                    <strong>HTTP Status:</strong> ${status} ${response.statusText}<br>
                    <strong>Content-Type:</strong> ${contentType || 'N/A'}<br>
                    <strong>Content-Length:</strong> ${contentLength ? (parseInt(contentLength) / 1024 / 1024).toFixed(2) + ' MB' : 'N/A'}<br>
                    <strong>URL:</strong> ${url}
                </div>`;

                if (status !== 200) {
                    html += `<div class="result error">
                        ‚ùå <strong>Sorun:</strong> Video dosyasƒ± bulunamadƒ± veya eri≈üilemiyor!<br>
                        <strong>Olasƒ± nedenler:</strong><br>
                        - Dosya sunucuda mevcut deƒüil<br>
                        - URL yanlƒ±≈ü<br>
                        - Nginx/Apache yapƒ±landƒ±rma hatasƒ±
                    </div>`;
                }

                resultDiv.innerHTML = html;
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">
                    ‚ùå <strong>Fetch Hatasƒ±:</strong><br>
                    ${error.message}<br><br>
                    <strong>Olasƒ± nedenler:</strong><br>
                    - CORS sorunu<br>
                    - Sunucu yanƒ±t vermiyor<br>
                    - Network hatasƒ±
                </div>`;
            }
        }

        function openInNewTab() {
            const url = document.getElementById('videoUrl').value;
            window.open(url, '_blank');
        }

        function testVideoLoad() {
            const url = document.getElementById('videoUrl').value;
            const video = document.getElementById('testVideo');
            const resultDiv = document.getElementById('videoResult');

            video.style.display = 'block';
            video.src = url;

            resultDiv.innerHTML = '<div class="result warning">‚è≥ Video y√ºkleniyor...</div>';

            video.onloadedmetadata = () => {
                resultDiv.innerHTML = `<div class="result success">
                    ‚úÖ <strong>Video ba≈üarƒ±yla y√ºklendi!</strong><br>
                    <strong>S√ºre:</strong> ${video.duration.toFixed(2)} saniye<br>
                    <strong>Boyut:</strong> ${video.videoWidth}x${video.videoHeight}<br>
                    <strong>Ready State:</strong> ${video.readyState}
                </div>`;
            };

            video.onerror = (e) => {
                const error = video.error;
                let errorMsg = 'Bilinmeyen hata';
                
                if (error) {
                    switch(error.code) {
                        case 1: errorMsg = 'MEDIA_ERR_ABORTED - Kullanƒ±cƒ± tarafƒ±ndan durduruldu'; break;
                        case 2: errorMsg = 'MEDIA_ERR_NETWORK - Network hatasƒ±'; break;
                        case 3: errorMsg = 'MEDIA_ERR_DECODE - Decode hatasƒ±'; break;
                        case 4: errorMsg = 'MEDIA_ERR_SRC_NOT_SUPPORTED - Kaynak desteklenmiyor veya bulunamadƒ±'; break;
                    }
                }

                resultDiv.innerHTML = `<div class="result error">
                    ‚ùå <strong>Video y√ºklenemedi!</strong><br>
                    <strong>Hata Kodu:</strong> ${error ? error.code : 'N/A'}<br>
                    <strong>A√ßƒ±klama:</strong> ${errorMsg}<br>
                    <strong>Network State:</strong> ${video.networkState}<br>
                    <strong>Ready State:</strong> ${video.readyState}
                </div>`;
            };
        }

        async function testCors() {
            const url = document.getElementById('videoUrl').value;
            const resultDiv = document.getElementById('corsResult');
            resultDiv.innerHTML = '<div class="result warning">‚è≥ CORS test ediliyor...</div>';

            try {
                const response = await fetch(url, { 
                    method: 'GET',
                    mode: 'cors'
                });

                const corsHeaders = {
                    'Access-Control-Allow-Origin': response.headers.get('Access-Control-Allow-Origin'),
                    'Access-Control-Allow-Methods': response.headers.get('Access-Control-Allow-Methods'),
                    'Access-Control-Allow-Headers': response.headers.get('Access-Control-Allow-Headers'),
                };

                let html = `<div class="result success">
                    ‚úÖ <strong>CORS Kontrol√º Ba≈üarƒ±lƒ±</strong><br>
                    <pre>${JSON.stringify(corsHeaders, null, 2)}</pre>
                </div>`;

                resultDiv.innerHTML = html;
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">
                    ‚ùå <strong>CORS Hatasƒ± Tespit Edildi!</strong><br>
                    ${error.message}<br><br>
                    <strong>√á√∂z√ºm:</strong> Video recorder sunucusunda CORS headers ekleyin.
                </div>`;
                
                showSolutions();
            }
        }

        function showSolutions() {
            const solutionsDiv = document.getElementById('solutions');
            solutionsDiv.innerHTML = `
                <h3>üîß Nginx Konfig√ºrasyonu (Video Recorder Sunucusu)</h3>
                <pre>location /outputs {
    alias /home/omer/recorder/public/outputs;
    
    # CORS headers
    add_header Access-Control-Allow-Origin "*";
    add_header Access-Control-Allow-Methods "GET, OPTIONS";
    add_header Access-Control-Allow-Headers "Origin, Content-Type";
    
    # Dosya boyutu
    client_max_body_size 500M;
    
    # MIME types
    types {
        video/mp4 mp4;
        video/webm webm;
    }
}</pre>
                
                <h3>üìù Test Komutlarƒ±</h3>
                <pre># URL'yi curl ile test et:
curl -I https://videocut.boencv.com/outputs/output_1759526107745.mp4_final_output.mp4

# Dosyanƒ±n ger√ßek yolu:
ls -lh /home/omer/recorder/public/outputs/output_1759526107745.mp4_final_output.mp4

# Nginx restart:
sudo systemctl restart nginx</pre>
            `;
        }

        // Sayfa y√ºklendiƒüinde otomatik test
        window.onload = () => {
            testUrl();
        };
    </script>
</body>
</html>


